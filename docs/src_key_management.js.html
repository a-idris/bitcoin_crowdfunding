<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/key_management.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/key_management.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** 
 * @module src/key_management
*/

const bitcore = require('bitcore-lib');
const Mnemonic = require('bitcore-mnemonic');

const config = require('../config.js');
var networkType = config.network;

bitcore.Networks.defaultNetwork = bitcore.Networks.testnet;
if (networkType == "mainnet") {
    bitcore.Networks.defaultNetwork = bitcore.Networks.livenet;
} else if (networkType == "regtest") {
    bitcore.Networks.enableRegtest(); 
}

// need this BIP-44 compliant path stem to be able to parse xpub on blockchain.info. 
// 44' - BIP, 0'/1' - bitcoin/ bitcoin testnet, 0' - account, 0/1 - external/internal. use internal only for change addresses
// m/44'/0'/0'/0 

// manually keep track of external and internal indices for easy new address generation

var keyutils = {}

var HDPrivateKey = bitcore.HDPrivateKey;
var HDPublicKey = bitcore.HDPublicKey;

keyutils.generateMnemonic = function() {
    // BIP-0039
    let code = new Mnemonic();
    console.log(code.toString());
    return code;
}

keyutils.validateMnemonic = function(code) {
    return Mnemonic.isValid(code);
}

keyutils.validateXpub = function(xpubString) {
    return HDPublicKey.isValidSerialized(xpubString, bitcore.Networks.defaultNetwork);
}

keyutils.generateXpriv = function (code, seed_passphrase) {
    let mnemonic = new Mnemonic(code);
    let root = mnemonic.toHDPrivateKey(seed_passphrase); //optional passphrase
    let coinType = (bitcore.Networks.defaultNetwork == bitcore.Networks.testnet) ? 1 : 0;
    // generate xpriv starting from the user's account. 
    let root_path = `M/44'/${coinType}'/0'`; 
    return root.derive(root_path);
}

keyutils.generateXpub = function(code, seed_passphrase) {
    let xpriv = keyutils.generateXpriv(code, seed_passphrase);
    return xpriv.hdPublicKey;
}

keyutils.derive = function(xkey, type, path) {
    if (type === "xpub") {
        // if arg is HDPublicKey, will return itself. If string will instantiate HDPublicKey
        xkey = new HDPublicKey(xkey); 
    } else if (type === "xpriv") {
        xkey = new HDPrivateKey(xkey);
    }
    return xkey.derive(path);
}

keyutils.getAddress = function(xkey) {
    if (xkey instanceof HDPrivateKey) {
        return xkey.privateKey.toAddress();
    } else if (xkey instanceof HDPublicKey) {
        return new bitcore.Address(xkey.publicKey);
    }
}

module.exports = keyutils;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-app.html">app</a></li><li><a href="module-client_js_create_project.html">client_js/create_project</a></li><li><a href="module-client_js_make_pledge.html">client_js/make_pledge</a></li><li><a href="module-client_js_register.html">client_js/register</a></li><li><a href="module-config.html">config</a></li><li><a href="module-routes_index.html">routes/index</a></li><li><a href="module-routes_login.html">routes/login</a></li><li><a href="module-routes_logout.html">routes/logout</a></li><li><a href="module-routes_projects.html">routes/projects</a></li><li><a href="module-routes_register.html">routes/register</a></li><li><a href="module-routes_users.html">routes/users</a></li><li><a href="module-src_api.html">src/api</a></li><li><a href="module-src_database.html">src/database</a></li><li><a href="module-src_key_management.html">src/key_management</a></li><li><a href="module-src_wallet.html">src/wallet</a></li></ul><h3>Classes</h3><ul><li><a href="Database.html">Database</a></li></ul><h3>Global</h3><ul><li><a href="global.html#parseCookie">parseCookie</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed May 02 2018 11:42:24 GMT+0100 (BST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
